
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Interactive Loras Campus Map — Search (Semantic Colors)</title>
<style>
  /* Correct, semantically named color variables */
  :root {
    --highlight:#FFF700;          /* marker highlight fill (yellow) */
    --highlight-border:#000000;   /* highlight stroke */
    --text:#222222;               /* primary text color */
    --surface:#ffffff;            /* surfaces: toolbar, badges */
    --shadow:0 4px 16px rgba(0,0,0,.1);
    --badge-bg:#f0f2f5;           /* hint bubble background */
  }

  body{ margin:0; font-family:system-ui, Segoe UI, Roboto, Arial, sans-serif; color:var(--text); background:#f7f7f9; }

  /* Layout: toolbar + badges above the map so they don't cover it */
  .wrap{
    width:100%;
    height:100vh;
    background:#fafafa;
    display:grid;
    grid-template-rows:auto auto 1fr; /* toolbar, badgebar, map */
    grid-template-columns: 1fr;
  }

  /* SVG should fill the remaining space */
  svg{ width:100%; height:100%; display:block; }

  g.marker { cursor: pointer; }
  g.marker circle{ fill:#fff; stroke:#000; stroke-width:1.25; }
  g.marker text{ fill:#111; font-weight:700; font-family:system-ui, Segoe UI, Roboto, Arial, sans-serif; pointer-events:none; }
  g.marker.highlight circle{ fill:var(--highlight) !important; stroke:var(--highlight-border) !important; stroke-width:3 !important; filter: drop-shadow(0 0 6px rgba(255,247,0,.55)); }
  g.marker.highlight text{ fill:#000; }

  /* Search toolbar (no longer absolute) */
  .toolbar{
    position:static;
    margin:16px;
    display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    padding:10px 12px; background:var(--surface); border-radius:12px; box-shadow:var(--shadow);
  }
  .searchbox{ position:relative; flex:1 1 320px; min-width:220px; }
  .searchbox input{ width:100%; box-sizing:border-box; padding:10px 36px 10px 12px; border-radius:10px; border:1px solid #d0d7de; background:#fff; font-size:15px; }
  .searchbox button.clear{ position:absolute; right:6px; top:50%; transform:translateY(-50%); border:0; background:transparent; width:28px; height:28px; border-radius:50%; font-size:18px; line-height:1; cursor:pointer; color:#666; }
  .searchbox button.clear:hover{ background:#f0f0f0; }
  .hint{ font-size:13px; color:#555; background:var(--badge-bg); padding:6px 10px; border-radius:999px; }

  /* Badge bar (no longer absolute) */
  .badgebar{
    position:static;
    margin:0 16px 16px 16px; /* below toolbar, above map */
    display:flex; gap:8px; flex-wrap:wrap; align-items:center;
    padding:10px 12px; background:var(--surface); border-radius:10px; box-shadow:var(--shadow);
    max-width:min(92vw, 1200px);
  }
  .chip{ display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; background:#fff3f3; color:#7a0000; border:1px solid #ffd1d1; font-size:14px; line-height:1; }
  .chip b{ font-weight:700; }

  /* When search is active, disable clicking */
  .clicks-disabled g.marker{ cursor:not-allowed; }
</style>
</head>
<body>
<div class="wrap">
  <div class="toolbar" role="region" aria-label="Map search">
    <div class="searchbox">
      <input id="search" type="search" placeholder="Search building names or try the tags food, class, sport, dorm" aria-label="Search buildings" autocomplete="off" />
      <button id="clearBtn" class="clear" aria-label="Clear search" title="Clear search">×</button>
    </div>
    <div id="hint" class="hint" aria-live="polite">Type to highlight buildings whose names/descriptions match.</div>
  </div>

  <div id="badgebar" class="badgebar" aria-live="polite" aria-label="Highlighted buildings"></div>

  <svg id="mapSvg" role="img" aria-label="Loras College Campus Map">
    <title>Loras College Campus Map</title>
    <image id="baseImg" x="0" y="0" href="map.png" width="100" height="100" preserveAspectRatio="xMidYMid meet" />
    <g id="markers"></g>
  </svg>
</div>



<script>
(function(){
  const svg = document.getElementById('mapSvg');
  const img = document.getElementById('baseImg');
  const markersG = document.getElementById('markers');
  const badgebar = document.getElementById('badgebar');
  const searchInput = document.getElementById('search');
  const clearBtn = document.getElementById('clearBtn');
  const hint = document.getElementById('hint');

  // nameMap left EXACTLY as your current page (no tags added). If you later add "|tag" to any string,
  // search will match it, while display will only show the part before the pipe.
  const nameMap = {
    "1": "Bill (A '52) and JoAnne Miller Academic Resource Center (MARC)|Library Spirt store Book",
    "2": "Alumni Campus Center (ACC)|student center food pub cafe cafeteria bar",
    "2A": "Cox Street Parking Lot",
    "3": "Lynch-McCarthy Apartments (LMAC)|dorm",
    "4": "Beckman Hall|dorm",
    "5": "Binz Hall|dorm",
    "6": "Byrne Oaks Complex (BO)|Dorm",
    "7": "Christ the King Chapel (CTK)|Help Desk|Technology",
    "8": "Faber-Clark Soccer Field|sports",
    "9": "Faber-Clark Softball Field|sports",
    "10": "Fieldhouse|Sports",
    "11": "Graber Sports Center|sports",
    "12": "Grotto",
    "13": "Hennessy Hall|Class",
    "13A": "Hennessy Hall Parking Lot",
    "14A": "Hoffmann Hall Parking Lot",
    "14": "Hoffmann Hall|Class",
    "15": "Keane Hall|Admissions Business Office class",
    "15A": "Keane Hall Parking/McClain Lot",
    "16": "Observatory",
    "17": "Physical Plant",
    "18": "Einstein Bros. Bagels|Food",
    "19": "Heitkamp Planetarium",
    "20": "Rock Bowl Stadium|sports",
    "21": "Rohlman Hall|Dorm",
    "22": "San Jose Swimming Pool",
    "23": "Smyth Hall|Dorm",
    "24": "St. Joseph Chapel/Music Hall",
    "25": "St. Joseph Hall of Science|Class",
    "26": "Tucker Tennis Courts|sports",
    "26A": "17th Street Parking Lot",
    "27": "Wahlert Hall|class",
    "28": "Athletic &amp; Wellness Center (AWC)|sports",
    "28A": "AWC Parking Lot",
    "29": "Alumni Plaza",
    "30": "Belmont House"
  };

  function visibleName(raw){
    return String(raw||'').split('|')[0].trim();
  }

  function drawMarker(key, x, y, r){
    const id = 'marker-' + key;
    const g = document.createElementNS('http://www.w3.org/2000/svg','g');
    g.setAttribute('id', id);
    g.setAttribute('class','marker');

    const c = document.createElementNS('http://www.w3.org/2000/svg','circle');
    c.setAttribute('cx', x); c.setAttribute('cy', y); c.setAttribute('r', r||18);

    const t = document.createElementNS('http://www.w3.org/2000/svg','text');
    t.setAttribute('x', x); t.setAttribute('y', y);
    t.setAttribute('dominant-baseline','middle'); t.setAttribute('text-anchor','middle');
    const fs = Math.max(10, (r||18) * 0.9); t.setAttribute('font-size', fs);
    t.textContent = key;

    const title = document.createElementNS('http://www.w3.org/2000/svg','title');
    title.textContent = `${visibleName(nameMap[key]||'Building')} (${key})`;

    g.appendChild(title); g.appendChild(c); g.appendChild(t);
    markersG.appendChild(g);
    return g;
  }

  function getHighlightedKeys(){
    return Array.from(document.querySelectorAll('g.marker.highlight'))
      .map(g => g.id.replace(/^marker-/i,'').toUpperCase());
  }

  function setHighlighted(keys){
    svg.querySelectorAll('g.marker.highlight').forEach(g=>g.classList.remove('highlight'));
    (keys||[]).forEach(k=>{ const g = document.getElementById('marker-'+k); if(g) g.classList.add('highlight'); });
    renderBadgebar(keys);
  }

  function renderBadgebar(keys){
    const list = (keys && keys.length ? keys : getHighlightedKeys()).slice();
    if(!list.length){ badgebar.innerHTML = '<span class="chip">No buildings selected</span>'; return; }
    list.sort((a,b)=>{ const rx=/^([0-9]+)([A-Z]?)$/; const ma=a.match(rx), mb=b.match(rx); if(ma&&mb){ const na=+ma[1], nb=+mb[1]; if(na!==nb) return na-nb; return (ma[2]||'').localeCompare(mb[2]||''); } return a.localeCompare(b); });
    badgebar.innerHTML = list.map(k => `<span class=\"chip\"><b>${k}</b> ${visibleName(nameMap[k]||'Building')}</span>`).join('');
  }

  function init(){
    const probe = new Image();
    probe.onload = () =>{
      svg.setAttribute('viewBox', `0 0 ${probe.naturalWidth} ${probe.naturalHeight}`);
      img.setAttribute('width', probe.naturalWidth); img.setAttribute('height', probe.naturalHeight);
      let mapping = {};
    try {
      const resp = await fetch('overlay-mapping.json', {cache: 'no-cache'});
      mapping = await resp.json();
    } catch(e) { console.error('Failed to load overlay-mapping.json', e); }
      for(const id in mapping){ const rec = mapping[id]; if(!rec) continue; const k = String(id).replace(/^marker-/i,'').toUpperCase(); const x=+rec.x, y=+rec.y, r=+rec.r||18; if(Number.isFinite(x)&&Number.isFinite(y)) drawMarker(k,x,y,r); }

      markersG.addEventListener('click', (e)=>{
        if(searchInput.value.trim() !== '') return; // ignore clicks during active search
        const g = e.target.closest('g.marker'); if(!g) return; const k = g.id.replace(/^marker-/i,'').toUpperCase();
        g.classList.toggle('highlight');
        renderBadgebar();
      });

      wireSearch();
    };
    probe.onerror = () =>{ console.error('map.png failed to load'); };
    probe.src = img.getAttribute('href') + '?v=' + Date.now();
  }

  function debounce(fn, ms){ let t; return function(...args){ clearTimeout(t); t = setTimeout(()=>fn.apply(this,args), ms); }; }

  function searchAndHighlight(term){
    const q = term.trim().toLowerCase();
    const container = svg;
    if(q === ''){
      container.classList.remove('clicks-disabled');
      hint.textContent = 'Type to highlight buildings whose names/descriptions match.';
      renderBadgebar();
      return;
    }

    container.classList.add('clicks-disabled');

    const drawnKeys = Array.from(markersG.querySelectorAll('g.marker')).map(g=>g.id.replace(/^marker-/i,'').toUpperCase());

    const matches = drawnKeys.filter(k => {
      const full = (nameMap[k]||'').toLowerCase();
      return full.includes(q) || k.toLowerCase().includes(q);
    });

    if(matches.length){
      hint.textContent = `${matches.length} match${matches.length!==1?'es':''} for "${term}"`;
    } else {
      hint.textContent = `No matches for "${term}"`;
    }

    setHighlighted(matches);
  }

  function wireSearch(){
    const run = debounce(()=> searchAndHighlight(searchInput.value), 120);
    searchInput.addEventListener('input', run);
    clearBtn.addEventListener('click', ()=>{ searchInput.value=''; searchInput.focus(); searchAndHighlight(''); });
  }

  init();
})();
</script>
</body>
</html>
