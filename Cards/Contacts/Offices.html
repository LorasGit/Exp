<script>
fetch("https://lorasgit.github.io/Exp/Cards/Contacts/Offices.json", { cache: "no-store" })
  .then(response => response.json())
  .then(data => {
    const offices = data.offices || [];
    offices.sort((a, b) => a.name.localeCompare(b.name));
    const container = document.getElementById('offices');

    offices.forEach(o => {
      // Build normalized phone display
      const rawPhone = o.phone || [o.area, o.prefix, o.line].filter(Boolean).join('-');
      const show_phone = (rawPhone || '').replace(/\s+/g, '').replace(/-+$/,'');

      // Build optional external links
      let linksHtml = '';
      if (!o.label1 && o.URL1) o.label1 = o.URL1;
      if (o.label1 && o.URL1) {
        linksHtml += `<a href="${o.URL1}" target
      }
      if (!o.label2 && o.URL2) o.label2 = o.URL2;
      if (o.label2 && o.URL2) {
        linksHtml += `${linksHtml ? '<br />' : ''}<a href="${o.URLel2}</a>`;
      }

      // Build the info block with no empty lines
      const infoLines = [];
      if (o.hours) infoLines.push(o.hours);
      if (o.location) infoLines.push(o.location);
      if (o.email) infoLines.push(`mailto:${o.email}${o.email}</a>`);
      if (show_phone) infoLines.push(show_phone);
      if (linksHtml) infoLines.push(linksHtml);

      const row = document.createElement('div');
      row.className = 'office-row';
      row.setAttribute('role', 'listitem');

      row.innerHTML = `
        <div class="office-info">
          <h3>${o.name}</h3>
          ${infoLines.join('<br />')}
        </div>
        <div class="office-actions" aria-label="Actions for ${o.name}">
          ${o.email ? `
            mailto:${o.email}
              <span class="material-symbols-outlined" aria-hidden="true">mail</span>
            </a>
          ` : ''}
          ${show_phone ? `
            tel:${show_phone}
              <span class="material-symbols-outlined" aria-hidden="true">call</span>
            </a>
          ` : ''}
        </div>`;
      container.appendChild(row);
    });
  })
  .catch(err => {
    document.getElementById('offices').innerHTML = `<p style="color:red">Error loading offices: ${err.message}</p>`;
  });
</script>

